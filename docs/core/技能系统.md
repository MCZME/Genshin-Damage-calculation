# Core - 技能系统 (Skill System)

技能系统是连接 `Character` 实体与 `ActionManager` (ASM) 引擎的桥梁，负责定义战斗逻辑的回调与数值规则。

## 1. 核心设计
在 V2 架构中，技能对象不再持有计时器或状态，而是作为 **“动作生成器”** 存在。

### 1.1 SkillBase (技能基类)
所有技能（普攻、战技、爆发）的祖先。
- **`to_action_data(params)`**: 核心接口。根据传入参数（如“长按”）生成 `ActionFrameData` 并绑定 `origin_skill`。
- **`on_execute_hit(target, index)`**: 命中回调。当 ASM 运行到判定点时被调用，此处负责实例化 `Damage` 对象并发布 `BEFORE_DAMAGE` 事件。
- **`on_frame_update()`**: 每帧回调。用于处理位移、召唤实体（如锅巴）或持续判定。

## 2. 技能分类
- **`NormalAttackSkill`**: 封装了多段普攻的序列生成逻辑。
- **`EnergySkill`**: 具备能量判定的大招基类。
- **`GenericSkill`**: [Deprecated] 建议直接继承 `SkillBase` 以获得更强的逻辑控制能力。

## 3. 实现示例 (V2 规范)
```python
class MySkill(SkillBase):
    def to_action_data(self, params=None) -> ActionFrameData:
        data = ActionFrameData(name="MY_SKILL", total_frames=60, hit_frames=[30])
        data.origin_skill = self # 必须绑定以接收回调
        return data

    def on_execute_hit(self, target, hit_index):
        # 构造伤害并发布事件 (DamageSystem 会接管后续计算)
        dmg = Damage(100.0, (Element.PYRO, 1.0), DamageType.SKILL, "我的伤害")
        self.caster.event_engine.publish(GameEvent(EventType.BEFORE_DAMAGE, ...))
```

## 4. 注册与绑定
角色子类通过在 `_setup_character_components` 中实例化技能并存入 `self.skills` 字典来完成绑定。

---
*版本: V2.2*
*更新日期: 2026-02-07*
