# Core - 生命值系统 (Health System)

生命值系统是仿真逻辑的终点站，负责执行最终的属性变动（治疗与伤害扣除）以及生存状态的发布。

## 1. 核心职责

### 1.1 数值合算 (Calculation)
利用 `HealingCalculator` 实现复杂的治疗量公式。支持以下三种属性缩放：
- **攻击力**
- **生命值上限**
- **防御力**

公式支持混合倍率：`治疗量 = (基础属性 * (百分比 / 100) + 固定值) * (1 + 治疗加成) * (1 + 受治疗加成)`。

### 1.2 动作接口对接
该系统直接调用 `CombatEntity` 的实体接口：
- `entity.heal(amount)`: 增加当前生命值（不超过上限）。
- `entity.hurt(amount)`: 扣除当前生命值。

---

## 2. 交互工作流

### 2.1 治疗流程 (Healing Flow)
1. 监听 `BEFORE_HEAL` 事件。
2. 调用 `HealingCalculator` 计算最终数值。
3. 执行实体回复。
4. 发布 `AFTER_HEAL` 事件。

### 2.2 受伤流程 (Hurt Flow)
这是系统中最精细的部分，涉及护盾的拦截逻辑：
1. 监听 `BEFORE_HURT` 事件。
2. **护盾介入点**: `ShieldSystem` 拥有较高的优先级，它会先修改事件中的 `amount`。
3. 执行实体扣血。
4. 发布 `AFTER_HURT` 事件（可供复仇类技能或死亡判定使用）。

---

## 3. 日志与调试

系统使用标准化日志记录每一次变动：
- **治疗**: 显示来源、目标及最终回复量。
- **受伤**: 记录实际产生的血量变动。若为无视护盾伤害，日志将带有点缀标记 `🩸 [侵蚀]`。

---

## 4. 扩展建议

### 4.1 侵蚀与特殊伤害 (Corrosion)
若要实现无视护盾的伤害（如侵蚀）：
- **发起**: 在发布 `BEFORE_HURT` 事件时，在 `data` 字典中设置 `ignore_shield: True`。
- **系统表现**: `ShieldSystem` 将自动忽略该事件，`HealthSystem` 将在执行扣血时正确记录特殊日志。

---
*版本: V2.3.1*
*更新日期: 2026-02-12*
