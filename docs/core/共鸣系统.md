# Core - 共鸣系统 (Resonance System)

共鸣系统负责管理队伍中由元素构成决定的全局增益效果。它采用了“初始化注入 + 运行时监听”的混合模式。

## 1. 激活规则

系统会在初始化 (`initialize`) 阶段扫描 `CombatSpace` 中的 `Faction.PLAYER` 实体。
- **触发条件**: 队伍中存在 4 名及以上角色，且某元素角色不少于 2 名。
- **管理方式**: 一个上下文（Context）内可同时激活多个共鸣效果。

---

## 2. 共鸣效果概览

### 2.1 静态注入类 (Static Stats)
在模拟开始前一次性写入角色面板，效率最高。
- **热诚之火 (Pyro)**: 攻击力提高 **25.0%**。
- **愈疗之水 (Hydro)**: 生命值上限提高 **25.0%**。
- **坚定之岩 (Geo)**: 护盾强效提升 **15.0%**。
- **蔓生之草 (Dendro)**: 元素精通固定提升 **50**。

### 2.2 动态监听类 (Dynamic Monitoring)
通过订阅伤害或反应事件，在战斗中实时触发。
- **粉碎之冰 (Cryo)**: 攻击受冰元素附着或冻结的敌人时，暴击率提高 **15.0%**。
- **强能之雷 (Electro)**: 触发雷系相关反应时生成能量微粒 (CD: 5秒)。
- **坚定之岩 (Geo)**: 处于护盾保护下时，造成的伤害提升 **15.0%**。

---

## 3. 实现细节

### 3.1 监听机制
`ResonanceSystem` 重点监听以下两个事件：
1. `BEFORE_CALCULATE`: 用于在伤害计算瞬间动态补正双暴或增伤乘区。
2. `AFTER_ELEMENTAL_REACTION`: 用于触发掉球等基于反应的奖励。

### 3.2 占位符设计
目前 `SwiftWind` (双风) 和 `Dendro` (双草高阶) 已保留代码入口，待未来机制深化时实装具体的体力/冷却缩短逻辑。

---

## 4. 架构优势

- **自动集成**: 通过 `create_context()` 自动注册，无需在组装器中手动干预。
- **无感适配**: 对于角色开发者，只需正确设置实体的 `element` 属性，共鸣系统即可自动识别。

---
*版本: V2.3.1*
*更新日期: 2026-02-12*
