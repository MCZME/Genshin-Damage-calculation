# 阶段二：战术编排 (Tactical Phase) - 完备性报告

> **目标**: 实现基于时间轴的战斗指令编排系统，打通配置意图到仿真引擎的数据链路。

## 1. 核心布局转换 (Pane Switching)
当进入战术阶段时，系统通过 `AnimatedSwitcher` 执行全量布局重组：
*   **左栏 (Action Library)**: 动作库。根据当前队伍动态生成“普通攻击”、“元素战技”等中文指令块。
*   **中栏 (Action Timeline)**: 指令序列。采用流式布局 (Flow Layout)，支持动作块的自由拖拽排序。
*   **右栏 (Action Inspector)**: 指令检视器。根据角色类的 `get_action_metadata()` 动态生成参数编辑器。

## 2. 关键特性实现

### 2.1 流式动作块 (Combo Flow Blocks)
*   **视觉指引**: 采用“首字强化”排版（如“技”、“爆”字号加大并应用元素色），提升序列扫描效率。
*   **拖拽排序**: 基于 `ft.Draggable` 与 `ft.DragTarget` 实现非线性排列下的位置交换逻辑。
*   **参数预览**: 在动作块上实时显示“长按”、“未命中”等关键参数摘要。

### 2.2 动态元数据驱动 (Metadata-Driven UI)
*   **契约化绑定**: 编辑器不再持有硬编码字段，而是通过 `CharacterClassMap` 反射查询角色特定的参数定义。
*   **自动表单生成**: 支持 `select` (Dropdown), `number` (TextField), `bool` (Switch) 等多种交互类型。

### 2.3 单次仿真驱动逻辑 (Single Simulation Mode)
*   **轻量化执行**: 弃用批处理模式，改为在 UI 协程中原地组装并运行 `Simulator`。
*   **无损传输**: `export_config()` 将 UI 的意图参数完整序列化为标准仿真契约 JSON。
*   **实时反馈**: 仿真进度与 DPS 结果实时推送到全局底栏 (Footer)。

---
*版本: v3.0.0*
*日期: 2026-02-10*