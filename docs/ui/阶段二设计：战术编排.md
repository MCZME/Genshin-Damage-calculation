# 阶段二设计：战术编排 (Tactics Phase) - [已实现]

## 1. 阶段概述
阶段二的核心任务是定义实体的行为意图序列。本阶段采用“流式布局”以处理大规模动作序列，并将右栏定义为动作的深度参数编辑器。UI 保持纯净的采集职能，不预测位移，不校验逻辑。

## 2. 布局实现 (Final Implementation)

### 2.1 左栏：动作库 (Action Library)
*   **实现**: 动态遍历当前队伍成员，为每个角色提供 [A/E/Q/S] (普攻/战技/爆发/切人) 快捷按钮。
*   **交互**: 点击按钮立即向全局 `actions` 序列追加指令。

### 2.2 中栏：动作序列流 (The Action Flow) —— **核心区域**
*   **视觉形态**: **流式瓷砖 (Flow Tiles)**。
    *   采用 `flex-wrap` 布局，动作块以玻璃质感卡片展示。
    *   **动态主题**: 背景侧条根据角色元素属性自动配色。
*   **交互规范**:
    *   **选中高亮**: 点击动作块切换主色调边框，并同步刷新右栏。
    *   **智能删除**: 删除中间动作时，后续索引自动平移，维持 `selected_action_idx` 指向正确。

### 2.3 右栏：动作参数编辑器 (Action Inspector)
*   **功能**: 提供单个动作的深度定制。
*   **编辑项**:
    *   **备注/意图**: 记录编排逻辑。
    *   **位移矢量**: 静态录入预期位移偏移量 (ΔX, ΔZ)。

## 3. 技术架构：状态与视图分离
为了应对复杂的交互，阶段二采用了模块化重构：
*   **`prototype_state.py`**: 纯逻辑层，持有 `PrototypeState` 类，负责数据序列化与仿真触发。
*   **`prototype_parts.py`**: 组件层，封装了圣遗物、角色编辑器等大型渲染块。
*   **`prototype.py`**: 路由与外壳，负责阶段分发逻辑。

## 4. 导出契约
动作流导出为标准的 `sequence_config` JSON 列表，格式为：
`[{"character_name": "...", "action_key": "...", "params": {...}}, ...]`

---
*版本: v1.2.0*
*日期: 2026-02-09*