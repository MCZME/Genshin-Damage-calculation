# 阶段一设计：战略筹备 (最终实现规范)

## 1. 交互架构：三栏式工作台 + 底部动作控制岛
采用了 MD3 + Genshin Glass 风格的沉浸式布局，将配置流程高度解耦：

*   **左栏 (Entity Manager)**: 
    *   **编队管理**: 动态添加角色占位符，支持悬浮删除。
    *   **目标列表**: 受击目标（ENEMIES）的快速切换中心。
*   **中栏 (Editor Pane)**: 
    *   **角色/目标详情**: 负责等级、命座、武器、圣遗物及目标抗性的精细化数值录入。
*   **右栏 (Tactical Radar)**: 
    *   **可视化战术板**: 俯视视角展示角色（绿色）与敌人（红色）的物理位置。
    *   **坐标系**: 中心点 (0,0)，映射游戏世界 ±10m 范围。
*   **底部 (Action Console)**: 
    *   **仿真主控**: 醒目的“开始仿真” Prominent Button。
    *   **持久化控制**: 配置的保存/加载中心，集成系统状态监控。

## 2. 数据驱动与安全契约
*   **配置中心化**: `PrototypeState` 维护与后端 `TeamFactory` 兼容的嵌套字典。
*   **物理下沉**: `SimulationAssembler` 现已打通坐标传输，支持从 JSON 自动配置实体的初始物理坐标。
*   **强类型约束**: 
    *   武器选择列表根据角色 `Type` 自动过滤。
    *   圣遗物套装使用带搜索的下拉选择（`ui.select`），并具备值合法性 Fallback。

## 3. 核心技术解决
*   **交互稳定性**: 圣遗物副词条编辑器采用局部渲染，解决了 NiceGUI 弹窗焦点丢失问题。
*   **抗递归设计**: 分离静态容器与动态网格，彻底解决了搜索/过滤时的 `RecursionError`。
*   **物理映射**: 实现了 UI 像素百分比与游戏米级坐标系的线性映射。

---
*状态: 阶段一完工 (Phase 1 Completed)*
*更新日期: 2026-02-08*