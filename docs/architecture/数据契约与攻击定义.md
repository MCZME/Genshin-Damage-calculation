# 架构设计：数据契约与攻击定义 (V2)

## 1. 核心契约：AttackConfig
`AttackConfig` 是所有攻击行为的“基因”，它定义了攻击的本质属性，这些属性在技能施放时即已确定，不随角色的实时面板波动。

### 1.1 字段规范
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| `element_u` | float | 初始元素附着量 (通常为 1.0, 2.0, 4.0) |
| `icd_tag` | str | 用于 ICD 计数器分组的标签 (如 "NormalAttack", "XianglingBurst") |
| `strike_type` | Enum | 打击类型 (DEFAULT, BLUNT, SLASH, PIERCE) |
| `is_deployable` | bool | 逻辑位，决定是否能触发“生成部署物”逻辑 (如绽放产生草原核) |
| `is_ranged` | bool | 判定是否为远程攻击，影响特定加成 |
| `hitbox` | HitboxConfig | 物理参数，决定 AOE 形状和碰撞范围 |

## 2. 物理契约：HitboxConfig
描述攻击在 `CombatSpace` 中的覆盖范围。

```python
@dataclass
class HitboxConfig:
    shape: AOEShape  # CIRCLE, SECTOR, RECT
    radius: float    # 半径/长度
    angle: float     # 扇形角度
    offset: tuple    # 相对偏移 (X, Y, Z)
```

## 3. 数据流转路径
1. **技能工厂 (`skills.py`)**：实例化 `AttackConfig` 并挂载到 `ActionFrameData`。
2. **动作执行 (`ActionManager`)**：当到达判定帧时，提取配置并创建 `Damage` 对象。
3. **空间广播 (`CombatSpace`)**：读取 `damage.config.hitbox` 进行空间检索。
4. **结算流水线 (`DamagePipeline`)**：
   - 根据 `icd_tag` 判定是否进行附着。
   - 根据 `is_deployable` 判定是否触发后续生成逻辑。

---
*状态: 现行规范*
*Author: Gemini CLI Agent*
*Date: 2026-02-07*
