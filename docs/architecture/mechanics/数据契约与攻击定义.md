# 架构设计：数据契约与攻击定义 (V2.1)

## 1. 核心契约：AttackConfig
`AttackConfig` 定义了攻击的本质属性。

### 1.1 字段规范
| 字段 | 类型 | 说明 |
| :--- | :--- | :--- |
| `element_u` | float | 初始元素附着量 |
| `icd_tag` | str | 用于 ICD 计数器分组的标签 |
| **`strike_type`** | **Enum** | **打击类型 (DEFAULT, PIERCE, BLUNT, THRUST, SLASH)** |
| `is_deployable` | bool | 决定是否能触发“生成部署物”逻辑 |
| `is_ranged` | bool | 判定是否为远程攻击 |
| `hitbox` | HitboxConfig | 物理参数，决定 AOE 形状和碰撞范围 |

## 2. 物理契约：HitboxConfig
描述攻击在 `CombatSpace` 中的覆盖范围。

### 2.1 形状定义 (`AOEShape`)
1. **SINGLE (单体)**：直接作用于锁定目标。
2. **SPHERE (球体)**：以坐标为中心，具有指定半径。
3. **CYLINDER (圆柱体)**：XZ轴圆判定，Y轴高度判定。
4. **BOX (长方体)**：定义 X, Y, Z 三轴长度。

```python
@dataclass
class HitboxConfig:
    shape: AOEShape
    radius: float    # 半径 (SPHERE/CYLINDER)
    height: float    # 高度 (CYLINDER/BOX)
    width: float     # 宽度 (BOX)
    length: float    # 长度 (BOX)
    offset: tuple    # 相对偏移 (X, Y, Z)
```

## 3. 逻辑分发
在 `DamagePipeline` 的 `_dispatch_broadcast` 阶段，系统会根据 `AOEShape` 的类型调用 `CombatSpace` 对应的检测算法。

---
*版本: v2.3.1*
*Date: 2026-02-07*