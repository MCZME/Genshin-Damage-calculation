# 架构设计：数据契约与攻击定义 (V2.4)

## 1. 核心契约：AttackConfig (物理与机制契约)
`AttackConfig` 定义了攻击的本质属性。V2.4 架构下，该契约强调“零翻译”的原生数据读取。

### 1.1 字段规范与原生映射
为了支持实测数据的直接录入，系统在装配阶段执行以下自动映射：

| CSV/Data 原生描述 | 内部枚举 (`Enum`) | 逻辑说明 |
| :--- | :--- | :--- |
| **球** | `AOEShape.SPHERE` | 以坐标 + Offset 为中心 |
| **长方体** | `AOEShape.BOX` | 三轴尺寸判定 |
| **圆柱** | `AOEShape.CYLINDER` | XZ轴圆判定，Y轴高度判定 |
| **默认 / 突刺 / 切割** | `StrikeType` | 打击感与物理交互规则 |

### 1.2 机制标识
*   **`attack_tag`**: 原始数据表标签，用于增伤分类解析。
*   **`icd_tag` / `icd_group`**: 强制要求的附着规则标识。
*   *注：`element_u` 已移至 `Damage` 对象在运行时从原生字典获取。*

## 2. 物理契约：HitboxConfig
描述攻击在 `CombatSpace` 中的覆盖范围。

### 2.1 形状定义 (`AOEShape`)
1. **SINGLE (单体)**：直接作用于锁定目标。
2. **SPHERE (球体)**：以坐标为中心，具有指定半径。
3. **CYLINDER (圆柱体)**：XZ轴圆判定，Y轴高度判定。
4. **BOX (长方体)**：定义 X, Y, Z 三轴长度。

```python
@dataclass
class HitboxConfig:
    shape: AOEShape
    radius: float    # 半径 (SPHERE/CYLINDER)
    height: float    # 高度 (CYLINDER/BOX)
    width: float     # 宽度 (BOX)
    length: float    # 长度 (BOX)
    offset: tuple    # 相对偏移 (X, Y, Z)
```

## 3. 逻辑分发
在 `DamagePipeline` 的 `_dispatch_broadcast` 阶段，系统会根据 `AOEShape` 的类型调用 `CombatSpace` 对应的检测算法。

---
*版本: v2.3.1*
*Date: 2026-02-07*