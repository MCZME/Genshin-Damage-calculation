# 架构设计：场景化实体引擎 (CombatSpace)

## 1. 概述
本设计将战场抽象为一个 **2D 连续坐标空间 (X, Z)**，辅以高度元数据 (Y)。系统专注于处理实体的空间分布与伤害广播，而不处理实体间的物理挤压交互。

## 2. 空间模型
### 2.1 坐标系统
- **核心坐标 (X, Z)**：用于所有 AOE 形状（圆、矩形、扇形）的碰撞判定。
- **元数据高度 (Y)**：不参与空间检索。仅作为数值参数（如下落攻击高度）传递给伤害计算流水线。

### 2.2 位移规则 (Displacement Logic)
- **禁用交互位移**：忽略由攻击引起的受击者位移（无击退、无吸引）。
- **自驱动位移**：仅处理由于技能释放（如冲刺、闪现）导致的攻击者自身位置变更。位置更新发生在伤害广播之前。

## 3. 核心抽象
### 3.1 场景容器 (CombatSpace)
- **实体索引**：维护实体的 (X, Z) 坐标与朝向。
- **查询接口**：`get_entities_in_2d_area(origin, shape, params)`。

### 3.2 战斗实体 (CombatEntity)
- **位置属性**：`(x, z)`。
- **朝向属性**：`facing_angle`（用于扇形攻击判定）。